<!DOCTYPE html>
<html>
<head>
    <title>Xpiriance</title>

    <!-- These are fixed css and js files need to include in every page -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="static/lib/css/materialize.min.css"  media="screen,projection"/>
    <script type="text/javascript" src="static/lib/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="static/lib/js/materialize.min.js"></script>
    <script type="text/javascript" src="static/lib/js/stickyfill.js"></script>
    <link rel="stylesheet" href="static/lib/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="static/lib/css/font-awesome.css"/>

    
    <!-- These are required css files used in this page -->
    <link href="https://cdn.quilljs.com/1.3.5/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="static/lib/quill_editor/quill-emoji.css">
    <script src="https://cdn.quilljs.com/1.3.5/quill.js"></script>
    <script type="text/javascript" src="static/lib/quill_editor/quill-emoji.js"></script>
    <script type="text/javascript" src="static/lib/quill_editor/quill_editor_url.js"></script>


    
    <!-- These are required js files used in this page -->
    <script type="text/javascript" src="static/js/general_js/header.js"></script>
    <script type="text/javascript" src="static/js/post_section_js/experience_text_editor.js"></script>
    <script type="text/javascript" src="static/js/post_section_js/discussion_text_editior.js"></script>
    <!-- <script type="text/javascript" src="static/js/post_section_js/retrieve_experience.js"></script> -->

    <link type="text/css" rel="stylesheet" href="static/css/general_css/header.css">
    <link type="text/css" rel="stylesheet" href="static/css/post_section/experience_text_section.css">
    <link type="text/css" rel="stylesheet" href="../../static/css/post_section/user_post.css">
    <link type="text/css" rel="stylesheet" href="../../static/css/post_section/experience_post.css">



    <style type="text/css">
        
        .home_content{
            margin-top: 90px;
            width: 100%;
        }

        .first_section{
            width: 45%;
            margin-left: 8%;
            float: left;
            text-align: justify;
        }

        .second_section{
            width: 35%;
            margin-left: 4%;
            float: left;
            text-align: justify;
        }

        .reply{
            visibility: hidden;
        }

        .reply_secondary_input{
            display: none;
        }

        .icons{
            cursor: pointer;
        }

        .parent_comment{
            color: #37474f;
        }
        .true{
            background-color: red;
        }
    </style>

    



</head>
<body>

    <div class="row no_padding_margin">




        

        <div class="col s12 home_content">

            <div class="first_section">
                
               <div class="col s12">

                   

                    <div class="user_timeline" id="user_timeline">


                        
                    </div>



                    
                </div>

            </div>

            <div class="second_section">


            </div>

        </div>


    </div>
   
    <script type="text/javascript">get_header_data();</script>




<script type="text/javascript">
    


function user_experience(post){

    var experience_format = [
        '<div class="card-panel row" id="card_panel" class="experience-post-group" id="user_'+post.user_profile_id+'exp_'+post.experience_id+'">',
            '<div class="col s12">',
                '<div>',
                    '<div class="post-tags">',
                        '<div class="chip no_chip">Related Tags : </div>',
    ].join("\n");

    var no_of_tags = Object.keys(post.exp_tags).length;

    for(var i = 0; i < no_of_tags; i++){
        experience_format += [
            '<a href="http://127.0.0.1:8000/title-' + post.exp_tags[i] +'" class="chip">'+ post.exp_tags[i] +'</a>',
        ]
    }
    
    experience_format += [                                   
                        '</div>',
                    '</div>',
                    '<div class="post-user-details-section">',
                        '<div class="post-user-image-section">',
                            '<a href="http://127.0.0.1:8000/user-' + post.user_profile_id +'"><img class="responsive-img post-user-image" src="'+ post.user_profile_image +'"></a>',
                        '</div>',
                        '<div class="post-user-intro-section">',
                            '<a href="http://127.0.0.1:8000/user-' + post.user_profile_id +'"><p class="post-user-name">'+ post.user_profile_name +'</p></a>',
                            '<p class="post-user-details"><i class="fa fa-dot-circle-o" aria-hidden="true"></i> '+ post.user_profile_intro +'</p>',
                        '</div>',
                    '</div>',
                '</div>',
                '<div class="row col s12 post-section">',
    ].join("\n");
    
    experience_format += [
    // This section is specifically for adding text
        '<p class="experience-intro">'+ post.exp_title +'</p>',
        '<div class="experience-text" id="show_more_exp_'+ post.experience_id +'">',
            '<div>'+ post.exp_preview_content +'<a id = "see_less_exp_'+ post.experience_id +'" onclick = show_more_exp_content(see_less_exp_'+ post.experience_id +')> see more....</a></div>',
            '<img class="responsive-img" src="'+ post.exp_preview_link +'" style="margin-top: 10px;">',
        '</div>',
    ].join("\n");


    experience_format += [
        // This section is for updating reviews
                    '<div class="col s12 iconslist" style="padding: 3px;">',
                        '<div class="col s4" style="text-align: center;">',
                            '<span class="icons review_exp_'+post.experience_id+'" id="current_review_'+post.experience_id+'"  onclick = send_update_current_experience_review("current_exp_review_'+post.experience_id+'")>',
                                '<i class="fa fa-thumbs-up" aria-hidden="true" style="font-size: 17px;"></i> Helpful &nbsp;<span class="icon_numbers" id="userful_'+post.experience_id+'">'+post.exp_review_count+'</span>',
                            '</span>',
                        '</div>',

                        '<div class="col s4" style="text-align: center;">',
                            '<span class="icons">',
                                '<i class="fa fa-comment" aria-hidden="true" style="font-size: 17px;"></i> Comment &nbsp;<span class="icon_numbers">'+post.no_of_comments+'</span>',
                            '</span>',
                        '</div>',
                        '<div class="col s4" style="text-align: right;">',
                            '<span class="icons">',
                                '<i class="fa fa-share" aria-hidden="true" style="font-size: 20px; margin-right: 50px;"></i>',
                                '<i class="fa fa-bookmark-o" aria-hidden="true" style="font-size: 20px;"></i></span>',
                            '</span>',
                        '</div>',
                    '</div>',
                '</div>',

    ].join("\n");

    var no_parent_comment =Object.keys(post.experience_comments).length;
    if(no_parent_comment>0){
        experience_format+=[
                    '<div class="col s12 comment_section" id="comment_section_'+post.experience_id+'">',
        ].join("\n");
        
        for (y in post.experience_comments){
            experience_format+=[
                        '<div class="new_comment" id="parent_'+post.experience_comments[y].parent_comment.comment_id+'">',
                            '<div class="primary_comment" onmouseenter=on_hover_id_calculation(primary_reply_'+post.experience_comments[y].parent_comment.comment_id+') onmouseleave=off_hover_id_calculation(primary_reply_'+post.experience_comments[y].parent_comment.comment_id+')>',
                                '<span class="parent_comment" id="primary_'+ post.experience_comments[y].parent_comment.comment_id +' "><b class="username"><a href="http://127.0.0.1:8000/user-'+post.experience_comments[y].parent_comment.user_name+'" style="color: #37474f;">'+post.experience_comments[y].parent_comment.name+' </a>&nbsp;</b>'+post.experience_comments[y].parent_comment.content+'</span>',
                                '<span class="reply" onclick="icon_show(primary_reply_'+post.experience_comments[y].parent_comment.comment_id+')" id="primary_reply_'+post.experience_comments[y].parent_comment.comment_id+'"><i class="material-icons reply_icon">reply</i></span>',
                            '</div>', 
            ].join("\n");

            experience_format +=[
                            '<div class="reply_comment" id="reply_comment_'+post.experience_comments[y].parent_comment.comment_id+' ">',
            ].join("\n");
            
            for(x in post.experience_comments[y].children_comment){
                experience_format+=[
                                '<div class="secondary_comment" onmouseenter="on_hover_id_calculation(parent_'+post.experience_comments[y].parent_comment.comment_id+'secondary_reply_'+post.experience_comments[y].children_comment[x].comment_id+')" onmouseleave="off_hover_id_calculation(parent_'+post.experience_comments[y].parent_comment.comment_id+'secondary_reply_'+post.experience_comments[y].children_comment[x].comment_id+')">',
                                    '<span class="child_comment" id="parent_'+post.experience_comments[y].parent_comment.comment_id+'secondary_'+ post.experience_comments[y].children_comment[x].comment_id +'"><b class="username"><a href="http://127.0.0.1:8000/user-'+post.experience_comments[y].children_comment[x].user_name+'" style="color: #37474f;">'+post.experience_comments[y].children_comment[x].name+' </a>&nbsp;</b>'+post.experience_comments[y].children_comment[x].content+'</span>',
                                    '<span class="reply" onclick="icon_show(parent_'+post.experience_comments[y].parent_comment.comment_id+'secondary_reply_'+post.experience_comments[y].children_comment[x].comment_id+')" id="parent_'+post.experience_comments[y].parent_comment.comment_id+'secondary_reply_'+post.experience_comments[y].children_comment[x].comment_id+'"><i class="material-icons reply_icon">reply</i></span>',
                                '</div>',
                ].join("\n");
            }
            
            experience_format+=[
                                '<div class="reply_secondary_input" id="write_comment_parent_'+post.experience_comments[y].parent_comment.comment_id+'">',
                                    '<input type="text" id="exp_'+post.experience_id+'_secondary_input_'+post.experience_comments[y].parent_comment.comment_id+'" onfocus="input_focus('+post.experience_id+','+post.experience_comments[y].parent_comment.comment_id+')" class="reply_comment_input" style="width: 95%; border-radius: 14px; height: 28px; padding-left: 14px; border: 1px solid rgba(100,100,100,0.5);" placeholder="Please write your comment here" name="">',
                                '</div>',
                            '</div>',
                        '</div>'
            ].join("\n");
        }

        experience_format+=[
                    '</div>'
        ].join("\n");
    }
    experience_format +=[
                    '<div class="col s12">',
                        '<div class="user_write_comment" id="user_write_comment_'+post.experience_id+'">',
                            '<input type="text" class="write_comment" onfocus="write_new_comment('+post.experience_id+')" placeholder="Write your comments on this post..." name="">',
                        '</div>',
                    '</div>',
                '</div>',

    ].join("\n");


    $("#user_timeline").append(experience_format); // this statement needs to be remove later

    if(post.current_exp_review){
        $('.review_exp_'+post.experience_id).css("color","blue");
    }

    last_review = post.current_exp_review;

} // this statememt needs to be remove later





function on_hover_id_calculation(id){
    $(id).css({"visibility":"visible"});
}

function off_hover_id_calculation(id){
    $(id).css({"visibility":"hidden"});
}

function new_work(id){
    $(id).css({"display" :"block"})
}


var last_review;

function send_update_current_experience_review(exp_id){
    exp_id = exp_id.split("_")[3];
    if(!last_review){
        $.ajax({
            url :  'http://127.0.0.1:8000/post/create_user_experience_review/',
            type : "POST",
            data : {
                exp_id: exp_id,
                csrfmiddlewaretoken : csrftoken,
            },
            success : function(json) {
                document.getElementById("userful_"+exp_id).innerHTML = json.exp_review_count+1;
                last_review = true;
                $('.review_exp_'+exp_id).css("color","blue");
                console.log(last_review);

            },
            error : function(xhr,errmsg,err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }
    
    else{
        $.ajax({
            url :  'http://127.0.0.1:8000/post/delete_user_experience_review/',
            type : "POST",
            data : {
                exp_id: exp_id,
                csrfmiddlewaretoken : csrftoken,
            },
            success : function(json) {
                document.getElementById("userful_"+exp_id).innerHTML =json.exp_review_count-1;
                $('.review_exp_'+exp_id).css("color","black");
                last_review = false;
                console.log(last_review);

            },
            error : function(xhr,errmsg,err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }
}



function show_more_exp_content(id){
    var exp_id = $(id).attr("id").split("_")[3];
    console.log(exp_id);
    $.ajax({
        url :  'http://127.0.0.1:8000/post/get_complete_user_experience/',
        type : "GET",
        data : {
            exp_id: exp_id,
            csrfmiddlewaretoken : csrftoken,
        },
        success : function(json) {
            console.log("Its working!!!!");
            $("#show_more_exp_" + json["exp_id"]).empty();
            $("#show_more_exp_" + json["exp_id"]).append(json["content"]);
            user_experience(json);
        },
        error : function(xhr,errmsg,err) {
        console.log(xhr.status + ": " + xhr.responseText);
        }
    });
    // console.log(id);
}


function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

var csrftoken = getCookie('csrftoken');

function send_experience_post_request(){
    $.ajax({
        url :  'http://127.0.0.1:8000/post/retrieve_user_experience/',
        type : "GET",
        data : {
            csrfmiddlewaretoken : csrftoken,
        },
        success : function(json) {
            console.log("Its working!!!!");
            console.log(json);
            user_experience(json);
        },
        error : function(xhr,errmsg,err) {
        console.log(xhr.status + ": " + xhr.responseText);
        }
    });
}

send_experience_post_request();




function icon_show(reply_id){
    var primary_comment_id = $(reply_id).parents(".new_comment").attr("id");
    $("#"+primary_comment_id).find(".reply_secondary_input").css({"display":"block"});    
}

function input_focus(exp_id,primary_comment_id){
    var comment_on_comment_write_dom_id=$("#exp_"+exp_id+"_secondary_input_"+primary_comment_id).attr("id");
    var comment_on_comment_write_dom =document.getElementById(comment_on_comment_write_dom_id);
    console.log($(comment_on_comment_write_dom).parent())
    comment_on_comment_write_dom.addEventListener("keyup",function(event){
        event.preventDefault();
        if (event.keyCode === 13) {
            content =$(comment_on_comment_write_dom).val();
            $(comment_on_comment_write_dom).val("");
            if(content.length>0){
                $.ajax({
                    url :"http://127.0.0.1:8000/post/create_experience_comment_on_comment/",
                    type :"POST",
                    data :{
                        "comment_id": primary_comment_id,
                        "content": content,
                        csrfmiddlewaretoken: csrftoken,
                    },
                    success:function(json){
                        console.log(json);
                        comment_on_comment_append(json);
                    },
                    error : function(xhr,errmsg,err) {
                        console.log(xhr.status + ": " + xhr.responseText);
                    }
                });
            }
            }
    });


    function comment_on_comment_append(post){
        var new_reply_dom =[
            '<div class ="secondary_comment" onmouseenter ="on_hover_id_calculation(parent_'+primary_comment_id+'secondary_reply_'+post.comment_id+')" onmouseleave ="off_hover_id_calculation(parent_'+primary_comment_id+'secondary_reply_'+post.comment_id+')">',
                '<span class="child_comment" id="parent_'+primary_comment_id+'secondary_'+post.comment_id+'"><b class="username"><a href="http://127.0.0.1:8000/user-'+post.user_name+'">'+post.name+'</a>&nbsp;</b>'+post.content+'</span>',
                '<span class="reply" onclick="icon_show(parent_'+primary_comment_id+'secondary_'+post.comment_id+')" id="parent_'+primary_comment_id+'secondary_reply_'+post.comment_id+'"><i class="material-icons reply_icon">reply</i></span>',
            '</div>',
        ].join("\n");
        
        $(new_reply_dom).insertBefore($(comment_on_comment_write_dom).parent());
        $(comment_on_comment_write_dom).parent().css({"display":"none"});
    }    
}



function write_new_comment(exp_id){
    console.log(exp_id)
    new_write_comment_id =$("#user_write_comment_"+exp_id).attr("id");
    var new_write_comment_dom =document.getElementById(new_write_comment_id);
    console.log(new_write_comment_dom);
    var i=0;

    function new_comment_append(post){
        $(new_write_comment_dom).find(".write_comment").val("");
        new_comment_parent_dom =$("#comment_section_"+exp_id);
        console.log(new_comment_parent_dom);
        new_comment_dom =[
            '<div class="new_comment" id="parent_'+post.comment_id+'">',
                    '<div class="primary_comment" onmouseenter=on_hover_id_calculation(primary_reply_'+post.comment_id+')  onmouseleave=off_hover_id_calculation(primary_reply_'+post.comment_id+')>',
                        '<span class="parent_comment" id="primary_'+ post.comment_id +' "><b class="username"><a href="http://127.0.0.1:8000/user-'+post.name+' ">'+post.user_name+' </a>&nbsp;</b>'+post.content+'</span>',
                        '<span class="reply" onclick="icon_show(primary_reply_'+post.comment_id+')" id="primary_reply_'+post.comment_id+'"><i class="material-icons reply_icon">reply</i></span>',
                    '</div>',
                    '<div class="reply_comment" id="reply_comment_'+post.comment_id+' ">',
                        '<div class="reply_secondary_input" id="write_comment_parent_'+post.comment_id+'">',
                            '<input type="text" id="exp_'+exp_id+'_secondary_input_'+post.comment_id+'" onfocus="input_focus('+exp_id+','+post.comment_id+')" class="reply_comment_input" style="width: 95%; border-radius: 14px; height: 28px; padding-left: 14px; border: 1px solid rgba(100,100,100,0.5);" placeholder="Please write your comment here" name="">',
                        '</div>',
                    '</div>',
                '</div>'
        ].join("\n");

        new_dom =$(new_comment_parent_dom).find(".new_comment")[0];
        console.log(new_dom);
        $(new_comment_dom).insertBefore(new_dom);
    }

    new_write_comment_dom.addEventListener("keyup",function(event){
        event.preventDefault();
        if (event.keyCode === 13) {
            var content =$(new_write_comment_dom).find(".write_comment").val();
            if(content.length >0){
                if(i==0){
                $.ajax({
                    url :"http://127.0.0.1:8000/post/create_user_experience_comment/",
                    type :"POST",
                    data :{
                        "exp_id" :exp_id,
                        "content"  :content,
                        csrfmiddlewaretoken : csrftoken,
                    },
                    success:function(json){
                        console.log(json);
                        new_comment_append(json);
                    },
                    error : function(xhr,errmsg,err) {
                        console.log(xhr.status + ": " + xhr.responseText);
                    }
                });
                i=1;
            }
            }
        }
    });
}



</script>































<script type="text/javascript">


        function user_discussion(post){
            var user_discussion_format=[
                '<div class="card-panel row" id="question_'+post.quest_id+'" class="experience-post-group" style="padding:0px;">',
                    '<div class="col s12">',
                        '<div class="post-tags">',
                            '<div class="chip no_chip">Related Tags : </div>',
            ].join("\n");
            var no_of_discussion_tags=Object.keys(post.quest_tags).length;
            for(var i = 0; i < no_of_discussion_tags; i++){
                user_discussion_format += [
                            '<a href="http://127.0.0.1:8000/title-' + post.quest_tags[i] +'" class="chip">'+ post.quest_tags[i] +'</a>',
                ].join("\n");
            }

            user_discussion_format+=[
                        '</div>',
                        '<div class="post-user-details-section">',
                            '<div class="post-user-image-section">',
                                '<a href="http://127.0.0.1:8000/user-' + post.quest_user_username+'"><img class="responsive-img post-user-image" src="'+ post.quest_user_image +'"></a>',
                            '</div>',
                            '<div class="post-user-intro-section">',
                                '<a href="http://127.0.0.1:8000/user-' + post.quest_user_username+'"><p class="post-user-name">'+ post.quest_user_name +'</p></a>',
                                '<p class="post-user-details"><i class="fa fa-dot-circle-o" aria-hidden="true"></i> '+ post.quest_user_intro +'</p>',
                            '</div>',
                        '</div>',
                    '</div>',
                    '<div class="row col s12 post-section">',
                        '<p class="question-text">'+post.quest_content+'</p>',
            ].join("\n");
            var no_of_answers =Object.keys(post.user_answers).length;
            for(var i=0;i<no_of_answers;i++){
                var no_of_comments_on_answer =Object.keys(post.user_answers[i].answer_comments).length;
                user_discussion_format+=[
                        '<div class="col s12 answer-section" id="quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'">',
                            '<div class="answer-user-details-section">',
                                '<div class="answer-user-image-section">',
                                    '<img class="responsive-img answer-user-image"  src="'+post.user_answers[i].user_profile_image+'" alt="'+post.user_answers[i].user_profile_name+'">',
                                '</div>',
                                '<div class="answer-user-intro-section">',
                                    '<p class="answer-user-name">'+post.user_answers[i].user_profile_name+'</p>',
                                    '<p class="answer-user-details"><i class="fa fa-dot-circle-o" aria-hidden="true"></i>'+post.user_answers[i].user_profile_intro+'</p>',
                                '</div>',
                            '</div>',
                            '<p class="answer-text">'+post.user_answers[i].ans_preview_content+'<a href="'+post.user_answers[i].ans_preview_link+'">  see more....</a></p>',
                            '<div class="col s12 iconslist" style="padding: 3px;">',
                                '<div class="col s4" style="text-align: center;" onclick="comment_box_show(quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+','+post.user_answers[i].answer_id+')">',
                                    '<span class="icons">',
                                        '<i class="fa fa-comment" aria-hidden="true"></i> Comment &nbsp;<span class="icon_numbers" id="quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_no_comment">'+no_of_comments_on_answer+'</span>',
                                    '</span>',
                                '</div>',
                                '<div class="col s4 agree review '+post.user_answers[i].current_agree_review+'" id="quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_agree_'+post.user_answers[i].current_agree_review+'" style="text-align:center" onclick="update_review_answer(quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_agree_'+post.user_answers[i].current_agree_review+','+post.user_answers[i].answer_id+','+post.quest_id+')">',
                                    '<span class="icons">',
                                        '<i class="fa fa-thumbs-up" aria-hidden="true"></i> Agree &nbsp;<span id="quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_no_agree" class="icon_numbers">'+post.user_answers[i].agree_review_count+'</span>',
                                    '</span>',
                                '</div>',
                                '<div class="col s4 disagree review '+post.user_answers[i].current_disagree_review+' " id="quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_disagree_'+post.user_answers[i].current_disagree_review+'" style="text-align: center;" onclick="update_review_answer(quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_disagree_'+post.user_answers[i].current_disagree_review+','+post.user_answers[i].answer_id+','+post.quest_id+')">',
                                    '<span class="icons">',
                                        '<i class="fa fa-thumbs-down" aria-hidden="true"></i> Disagree &nbsp;<span id="quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+'_no_disagree" class="icon_numbers">'+post.user_answers[i].disagree_review_count+'</span>',
                                    '</span>',
                                '</div>',
                            '</div>',

                ].join("\n");
                var no_of_comments_on_answer =Object.keys(post.user_answers[i].answer_comments).length;
                    user_discussion_format+=[
                            '<div class="col s12 comment_section" style="margin-left:10px;" >',
                    ].join("\n");

                    for(comment in post.user_answers[i].answer_comments){
                        user_discussion_format+=[
                                '<div class="primary_comment" id="quest_'+post.quest_id+'answer_'+post.user_answers[i].answer_id+'_comment_'+post.user_answers[i].answer_comments[comment].comment_id+'">',
                                    '<span class="parent_comment">',
                                        '<b class="username">'+post.user_answers[i].answer_comments[comment].name+'</b> &nbsp;'+post.user_answers[i].answer_comments[comment].content+'</span>',
                                    '</span>',
                                '</div>',
                        ].join("\n");
                    }

                    // user_discussion_format+=[
                    //         '</div>',
                    // ].join("\n");
                user_discussion_format+=[
                                '<div class="col s12 reply_secondary_input" id="write_comment_parent_'+post.user_answers[i].answer_id+'" style="margin-left:10px;">',
                                    '<input type="text" class="reply_comment_input" onfocus="new_comment_on_answer(quest_'+post.quest_id+'_answer_'+post.user_answers[i].answer_id+','+post.user_answers[i].answer_id+','+post.quest_id+')" style="width: 95%; border-radius: 14px; height: 28px; padding-left: 14px; border: 1px solid rgba(100,100,100,0.5);" placeholder="Please write your comment here" name="">',
                                '</div>',
                            '</div>',
                        '</div>',
                    ].join("\n");
            }


            user_discussion_format+=[
                        '<div class="col s12 answer_write">',
                            '<div class="user_write_comment" id="user_write_comment_quest_'+post.quest_id+'" >',
                                '<input type="" class="write_comment" onfocus="write_new_answer(user_write_comment_quest_'+post.quest_id+','+post.quest_id+')" placeholder="Write your answer on this post..." name="">',
                            '</div>',
                        '</div>',
                    '</div>',
                '</div>',
            ].join("\n");   

            $("#user_timeline").append(user_discussion_format);

        }


        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function send_discussion_post_request(){
            $.ajax({
                 url :  'http://127.0.0.1:8000/post/retrieve_user_discussion/',
                type : "GET",
                data : {
                    csrfmiddlewaretoken : csrftoken,
                },
                success : function(json) {
                    console.log(json);
                    user_discussion(json);
                },
                error : function(xhr,errmsg,err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        }

        send_discussion_post_request();

        function comment_box_show(id,answer_id,quest_id){
            quest_answer_id = $(id).attr("id");
            console.log(quest_answer_id);
            console.log(answer_id);
            $(id).find(".reply_secondary_input").css({"display":"block"});
        }

        function new_comment_on_answer(id,answer_id,quest_id){
            console.log(quest_id);
            var new_comment_on_answer_dom_id =$(id).find(".reply_secondary_input").attr("id");
            var new_comment_on_answer_add_dom =document.getElementById(new_comment_on_answer_dom_id);
            var new_comment_on_answer_write_dom = $(new_comment_on_answer_add_dom).find(".reply_comment_input");
            console.log(new_comment_on_answer_write_dom);
            new_comment_on_answer_add_dom.addEventListener("keyup",function(event){
                event.preventDefault();
                if (event.keyCode === 13) {
                    var content= $(new_comment_on_answer_write_dom).val();
                    $(new_comment_on_answer_write_dom).val("");
                    console.log(content);
                    if(content.length >0){
                        $.ajax({
                        url:'http://127.0.0.1:8000/post/create_user_answer_comment/',
                         type :'POST',
                        data:{
                            csrfmiddlewaretoken : csrftoken,
                            "ans_id":answer_id,
                            "content":content,
                        },
                        success: function(json){
                            console.log(json);
                            new_comment_on_answer_append(json);
                        },
                        error: function(xhr,errmsg,err){
                            console.log(xhr.status + ": " + xhr.responseText);

                        },
                        });
                    }
                }

            },false);

            function new_comment_on_answer_append(post){
                document.getElementById("quest_"+quest_id+"_answer_"+answer_id+"_no_comment").innerHTML=post.no_of_comments;
                $(id).find(".reply_secondary_input").css({"display":"none"});
                var new_comment_on_answer_parent_dom = $(id).find(".comment_section");
                var new_comment_on_answer_sibling_dom = $(id).find(".comment_section").find(".primary_comment")[0];
                new_comment_on_answer_dom=[
                    '<div class="primary_comment" id="'+quest_answer_id+'_comment_'+post.comment_id+'">',
                        '<span class="parent_comment">',
                            '<a href="http://127.0.0.1:8000/user-'+post.user_name+'"><b class="username">'+post.name+'</b></a>&nbsp;'+post.content+'</span>',
                        '</span>',
                    '</div>',
                ].join("\n");
                if(new_comment_on_answer_sibling_dom){
                    $(new_comment_on_answer_dom).insertBefore(new_comment_on_answer_sibling_dom);
                }
                else{
                    new_comment_on_answer_parent_dom .append($(new_comment_on_answer_dom));
                }
            }

        }
        function write_new_answer(id,quest_id){
            var new_answer_add_dom_id=$(id).attr("id");
            console.log(quest_id);
            var new_answer_add_dom =document.getElementById(new_answer_add_dom_id);
            var new_answer_write_dom=$(new_answer_add_dom).find(".write_comment");
            var question_dom =$("#question_"+quest_id).find(".post-section");
            function new_answer_append_dom(post){
                var question_post_section_dom =$("#question_"+quest_id).find(".post-section").find(".answer_write");
                var new_answer_dom=[
                    '<div class="col s12 answer-section" id="quest_'+quest_id+'_answer_'+post.answer_id+'">',
                            '<div class="answer-user-details-section">',
                                '<div class="answer-user-image-section">',
                                    '<img class="responsive-img answer-user-image"  src="'+post.user_profile_link+'" alt="'+post.user_profile_name+'">',
                                '</div>',
                                '<div class="answer-user-intro-section">',
                                    '<p class="answer-user-name">'+post.user_profile_name+'</p>',
                                    '<p class="answer-user-details"><i class="fa fa-dot-circle-o" aria-hidden="true">'+post.user_profile_intro+'</i></p>',
                                '</div>',
                            '</div>',
                            '<p class="answer-text">'+post.content+'</p>',
                            '<div class="col s12 iconslist" style="padding: 3px;">',
                                '<div class="col s4" style="text-align: center;" onclick="comment_box_show(quest_'+quest_id+'_answer_'+post.answer_id+','+post.answer_id+','+quest_id+')">',
                                    '<span class="icons">',
                                        '<i class="fa fa-comment" aria-hidden="true"></i> Comment &nbsp;<span id="quest_'+quest_id+'_answer_'+post.answer_id+'_no_comment" class="icon_numbers">0</span>',
                                    '</span>',
                                '</div>',
                                '<div class="col s4 agree review false" id="quest_'+quest_id+'_answer_'+post.answer_id+'_agree_false" style="text-align:center" onclick="update_review_answer(quest_'+quest_id+'_answer_'+post.answer_id+'_agree_false,'+post.answer_id+','+quest_id+')">',
                                    '<span class="icons">',
                                        '<i class="fa fa-thumbs-up" aria-hidden="true"></i> Agree &nbsp;<span id="quest_'+quest_id+'_answer_'+post.answer_id+'_no_agree" class="icon_numbers">0</span>',
                                    '</span>',
                                '</div>',
                                '<div class="col s4 disagree review false" id="quest_'+quest_id+'_answer_'+post.answer_id+'_disagree_false" style="text-align: center;" onclick="update_review_answer(quest_'+quest_id+'_answer_'+post.answer_id+'_disagree_false,'+post.answer_id+','+quest_id+')">',
                                    '<span class="icons">',
                                        '<i class="fa fa-thumbs-down" aria-hidden="true"></i> Disagree &nbsp;<span id="quest_'+quest_id+'_answer_'+post.answer_id+'_no_disagree"  class="icon_numbers">0</span>',
                                    '</span>',
                                '</div>',
                            '</div>',
                            '<div class="col s12 comment_section" style="margin-left:10px;" >',
                            '<div class="col s12 reply_secondary_input" id="write_comment_parent_'+post.answer_id+'" style="margin-left:10px;">',
                                    '<input type="text" onfocus="new_comment_on_answer(quest_'+quest_id+'_answer_'+post.answer_id+','+post.answer_id+','+quest_id+')"class="reply_comment_input" style="width: 95%; border-radius: 14px; height: 28px; padding-left: 14px; border: 1px solid rgba(100,100,100,0.5);" placeholder="Please write your comment here" name="">',
                                '</div>',
                            '</div>',
                        '</div>',

                ].join("\n");
                $(new_answer_dom).insertBefore(question_post_section_dom)
            }

            new_answer_add_dom.addEventListener("keyup",function(event){
                event.preventDefault();
                if(event.keyCode ===13){
                    var content =$(new_answer_write_dom).val();
                    $(new_answer_write_dom).val("");

                    if(content.length>0){
                            $.ajax({
                                url:'http://127.0.0.1:8000/post/user_answer_create/',
                                type :'POST',
                                data:{
                                    csrfmiddlewaretoken : csrftoken,
                                    "quest_id":quest_id,
                                    "content":content,
                                    "visibility":true,
                                },
                                success: function(json){
                                    console.log(json);
                                    new_answer_append_dom(json);

                                },
                                error: function(xhr,errmsg,err){
                                    console.log(xhr.status + ": " + xhr.responseText);

                                },
                            },false); 
                        }
                       
                    }
                    
            });
        }
        function update_review_answer(id,answer_id,quest_id){
            var click_class =$(id).attr("class").split(" ")[2];
            var click_id=$(id).attr("id");
            var agree_review;
            var disagree_review;
            if($("#"+click_id).hasClass("true")){
                if(click_class =="agree"){
                    agree_review =false;
                }
                if(click_class == "disagree"){
                    disagree_review=false;
                }
                $("#"+click_id).removeClass("true");
                if($("#"+click_id).siblings(".review").hasClass("false")){
                    $("#"+click_id).siblings(".review").removeClass("false")
                }
                $.ajax({
                    url:'http://127.0.0.1:8000/post/get_user_answer_review/',
                    type :'POST',
                    data:{
                        csrfmiddlewaretoken : csrftoken,
                        "ans_id" :answer_id,
                        "agree"  :agree_review,
                        "disagree":disagree_review
                    },
                    success: function(json){
                        console.log(json);
                        review_update(json);
                    },
                    error: function(xhr,errmsg,err){
                        console.log(xhr.status + ": " + xhr.responseText);

                    },
                },false); 
            }
            else{
                $("#"+click_id).addClass("true");
                if($("#"+click_id).siblings(".review").hasClass("true")){
                    $("#"+click_id).siblings(".review").removeClass("true");
                }
                if(click_class =="agree"){
                    agree_review =true;
                }
                if(click_class == "disagree"){
                    disagree_review=true;
                }
                $.ajax({
                    url:'http://127.0.0.1:8000/post/get_user_answer_review/',
                    type :'POST',
                    data:{
                        csrfmiddlewaretoken : csrftoken,
                        "ans_id" :answer_id,
                        "agree"  :agree_review,
                        "disagree":disagree_review
                    },
                    success: function(json){
                        console.log(json);
                        review_update(json);
                    },
                    error: function(xhr,errmsg,err){
                        console.log(xhr.status + ": " + xhr.responseText);

                    },
                },false); 
            }
            function review_update(post){
                document.getElementById("quest_"+quest_id+"_answer_"+answer_id+"_no_agree").innerHTML=post.agree_count;
                document.getElementById("quest_"+quest_id+"_answer_"+answer_id+"_no_disagree").innerHTML=post.disagree_count;
            }
        }
</script>
<script type="text/javascript">
    
</script>
</body>
</html>
